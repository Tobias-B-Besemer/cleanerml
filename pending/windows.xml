<?xml version="1.0" encoding="UTF-8"?>
<!--

    BleachBit
    Copyright (C) 2008-2019 Andrew Ziem
    https://www.bleachbit.org

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    @app Microsoft Windows
    @url https://www.microsoft.com/en-us/windows
    @os Windows
    @cleanerversion v1.9.0
    @cleanerdate 2019-03-22
    @cleanerby https://github.com/Tobias-B-Besemer (2019-02-26 - 2019-03-22)
    @tested ok v???, Windows 7
    @testeddate 2019-03-10 (... with an old version of the cleaner!)
    @testedby https://github.com/Tobias-B-Besemer
    @note Can maybe one day replace the hardcoded Windows cleaner of BleachBit...
    @note Should maybe be integrated:
    @note - windows_memory_dumps.xml
    @note - windows_shellbags.xml
    @note - windows_update.xml

-->
<cleaner id="windows" os="windows">
  <label>Windows</label>
  <description>Operating system</description>
  <option id="temp">
    <!-- I don't like it, but lets delete the Windows temp folder with the temp folder of the user together. Tobias.
    Was:
    <label>Windows temp files and folders</label>
    <description>Delete the temp files and folders in the Windows directory</description>
    Is now: -->
    <label>Temporary files</label>
    <description>Delete the temporary files</description>
    <!-- Temp files and folders of the installers: -->
    <action command="delete" search="walk.all" path="%WinDir%\Installer\MSI*.tmp*"/>
    <action command="delete" search="glob" path="%WinDir%\Installer\MSI*.tmp*"/>
    <!-- Windows temp folder: -->
    <action command="delete" search="walk.all" path="%WinDir%\Temp\"/>
    <!-- User temp folder: -->
    <action command="delete" search="walk.all" path="%Temp%\"/>
    <!-- Delete *.tmp recursive in %WinDir%: -->
    <action command="delete" search="walk.files" path="%WinDir%\" regex="\.[Tt][Mm][Pp]$"/>
  </option>
  <option id="logs">
    <label>Logs</label>
    <description>Delete the logs</description>
    <!-- Delete *.log recursive in %WinDir%: -->
    <action command="delete" search="walk.files" path="%WinDir%\" regex="\.[Ll][Oo][Gg]$"/>
    <!--
    64-bit Windows redirects %WinDir%\sysnative\ for 32-bit applications to %WinDir%\system32 
    https://docs.microsoft.com/en-us/windows/desktop/winprog64/file-system-redirector
    -->
    <!-- Already deleted: <action command="delete" search="glob" path="%WinDir%\sysnative\config\*.log"/> -->
    <action command="delete" search="glob" path="%WinDir%\sysnative\config\*.log1"/>
    <action command="delete" search="glob" path="%WinDir%\sysnative\config\*.log2"/>
    <action command="delete" search="glob" path="%SystemDrive%\Boot\*.log"/>
    <action command="delete" search="glob" path="%SystemDrive%\Boot\*.log1"/>
    <action command="delete" search="glob" path="%SystemDrive%\Boot\*.log2"/>
    <action command="delete" search="glob" path="%ProgramData%\Microsoft\Search\Data\Applications\Windows\*.log"/>
    <!-- Logs to delete in Windows, taken from:
    https://github.com/bleachbit/bleachbit/blob/4bd296808a6342a8d80f169adce35216a3330cd0/bleachbit/Cleaner.py#L400
    Start: -->
    <action command="delete" search="file" path="%WinDir%\OEWABLog.txt"/>
    <action command="delete" search="file" path="%WinDir%\SchedLgU.txt"/>
    <action command="delete" search="file" path="%WinDir%\ntbtlog.txt"/>
    <action command="delete" search="file" path="%WinDir%\setuplog.txt"/>
    <action command="delete" search="walk.files" path="%WinDir%\SoftwareDistribution\DataStore\Logs\*"/>
    <action command="delete" search="glob" path="%WinDir%\system32\LogFiles\AIT\AitEventLog.etl.???"/>
    <action command="delete" search="glob" path="%WinDir%\system32\LogFiles\Firewall\pfirewall.log*"/>
    <action command="delete" search="glob" path="%WinDir%\system32\LogFiles\Scm\SCM.EVM*"/>
    <action command="delete" search="glob" path="%WinDir%\system32\LogFiles\WMI\Terminal*.etl"/>
    <action command="delete" search="glob" path="%WinDir%\system32\LogFiles\WMI\RTBackup\EtwRT.*etl"/>
    <action command="delete" search="glob" path="%WinDir%\system32\wbem\Logs\*.lo_"/>
    <!-- Already deleted:
    <action command="delete" search="glob" path="%WinDir%\Debug\*.log"/>
    <action command="delete" search="file" path="%WinDir%\Debug\Setup\UpdSh.log"/>
    <action command="delete" search="glob" path="%WinDir%\Debug\UserMode\*.log"/>
    <action command="delete" search="glob" path="%WinDir%\security\logs\*.log"/>
    <action command="delete" search="glob" path="%WinDir%\SoftwareDistribution\*.log"/>
    <action command="delete" search="file" path="%WinDir%\system32\TZLog.log"/>
    <action command="delete" search="glob" path="%WinDir%\system32\wbem\Logs\*.log"/>
    -->
    <!-- Finish! -->
    <!-- More: -->
    <action command="delete" search="glob" path="%WinDir%\system32\LogFiles\HTTPERR\httperr?.log"/>
    <action command="delete" search="file" path="%WinDir%\system32\LogFiles\Srt\bcdinfo.txt"/>
    <action command="delete" search="file" path="%WinDir%\system32\LogFiles\Srt\bootfailure.txt"/>
    <action command="delete" search="file" path="%WinDir%\system32\LogFiles\Srt\disklayout.txt"/>
    <action command="delete" search="file" path="%WinDir%\system32\LogFiles\Srt\SrtTrail.txt"/>
  </option>
  <option id="backups">
    <label>Backup files</label>
    <description>Delete the backup files</description>
    <!-- Delete *.bak recursive in %WinDir%: -->
    <action command="delete" search="walk.files" path="%WinDir%\" regex="\.[Bb][Aa][Kk]$"/>
    <!-- Delete *.old recursive in %WinDir%: -->
    <action command="delete" search="walk.files" path="%WinDir%\" regex="\.[Oo][Ll][Dd]$"/>
    <!-- Backup files of the boot manager: -->
    <action command="delete" search="glob" path="%SystemDrive%\Boot\BCD.Backup.*"/>
    <!-- Backup files to delete in Windows, taken from:
    https://github.com/bleachbit/bleachbit/blob/4bd296808a6342a8d80f169adce35216a3330cd0/bleachbit/Cleaner.py#L400
    Start: -->
    <!-- Already deleted:
    <action command="delete" search="file" path="%WinDir%\imsins.BAK"/>
    <action command="delete" search="file" path="%WinDir%\REGLOCS.OLD"/>
    <action command="delete" search="file" path="%WinDir%\Debug\UserMode\ChkAcc.bak"/>
    <action command="delete" search="file" path="%WinDir%\Debug\UserMode\userenv.bak"/>
    <action command="delete" search="glob" path="%WinDir%\security\logs\*.old"/>
    -->
    <!-- Finish! -->
  </option>
  <option id="hibernate">
    <label>Hibernate system</label>
    <description>Turns the hibernate system off and delete the hibernate file</description>
    <action command="process" cmd="powercfg.exe /hibernate off"/>
  </option>
  <option id="junk">
    <label>Junk files and folders</label>
    <description>Delete old files and folders that are no more needed</description>
    <action command="delete" search="file" path="%UserProfile%\Desktop\desktop.ini"/>
    <action command="delete" search="file" path="%SystemDrive%\BOOTSECT.BAK"/>
    <action command="delete" search="walk.all" path="%SystemDrive%\Config.Msi\"/>
    <action command="delete" search="file" path="%SystemDrive%\Config.Msi\"/>
  </option>
  <option id="chkdsk">
    <label>Chkdsk files</label>
    <description>Delete the files</description>
    <action command="delete" search="walk.files" path="%SystemDrive%\File*.chk"/>
    <action command="delete" search="walk.all" path="%SystemDrive%\System Volume Information\Chkdsk\"/>
    <action command="delete" search="file" path="%SystemDrive%\System Volume Information\Chkdsk\"/>
  </option>
  <option id="wer">
    <label>Windows Error Reporting</label>
    <description>Delete the files</description>
    <action command="delete" search="walk.all" path="%AllUsersProfile%\Microsoft\Windows\WER\ReportArchive\"/>
    <action command="delete" search="walk.all" path="%AllUsersProfile%\Microsoft\Windows\WER\ReportQueue\"/>
    <action command="delete" search="walk.all" path="%AllUsersProfile%\Microsoft\Windows\WER\Temp\"/>
    <!--
    As we want to delete the WER, why don't we do the following: (Tobias)
    <action command="delete" search="walk.all" path="%AllUsersProfile%\Microsoft\Windows\WER\"/>
    <action command="delete" search="file" path="%AllUsersProfile%\Microsoft\Windows\WER\"/>
    -->
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\WER\ReportArchive\"/>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\WER\ReportQueue\"/>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\WER\Temp\"/>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\WER\ERC\"/>
    <!--
    As we want to delete the WER, why don't we do the following: (Tobias)
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\WER\"/>
    <action command="delete" search="file" path="%LocalAppData%\Microsoft\Windows\WER\"/>
    -->
    <action command="delete" search="walk.all" path="%LocalAppData%\ElevatedDiagnostics\"/>
    <!--
    As we want to delete the WER, why don't we do the following: (Tobias)
    <action command="delete" search="walk.all" path="%LocalAppData%\ElevatedDiagnostics\"/>
    <action command="delete" search="file" path="%LocalAppData%\ElevatedDiagnostics\"/>
    -->
    <action command="winreg" path="HKCU\Software\Microsoft\Windows\Windows Error Reporting\Debug" name="StoreLocation"/>
    <action command="winreg" path="HKLM\Software\Microsoft\Windows\Windows Error Reporting\Debug" name="StoreLocation"/>
    <action command="winreg" path="HKU\.DEFAULT\Software\Microsoft\Windows\Windows Error Reporting\Debug" name="StoreLocation"/>
    <!-- WER file in the temp folder: -->
    <action command="delete" search="file" path="%Temp%\WERFAB3.tmp.WERInternalMetadata.xml"/>
    <!--
    Windows Error Reporting, HEAP-Dumps:
    <action command="delete" search="walk.files" path="%WinDir%\Temp\WER*.hdmp"/>
    -->
    <!--
    Windows Error Reporting, Mini-Dumps:
    <action command="delete" search="walk.files" path="%WinDir%\Temp\WER*.mdmp"/>
    -->
    <action command="delete" search="walk.files" path="%WinDir%\Temp\WER*"/>
    <!-- Logs to delete in Windows, taken from:
    https://github.com/bleachbit/bleachbit/blob/4bd296808a6342a8d80f169adce35216a3330cd0/bleachbit/Cleaner.py#L400
    Start: -->
    <action command="delete" search="glob" path="%AllUsersProfile%\Application Data\Microsoft\Dr Watson\*.log"/>
    <!-- Already done above:
    <action command="delete" search="walk.files" path="%LocalAppData%\Microsoft\Windows\WER\ReportArchive\*\*"/>
    <action command="delete" search="walk.files" path="%LocalAppData%\Microsoft\Windows\WER\ReportQueue\*\*"/>
    -->
    <action command="delete" search="walk.files" path="%ProgramData%\Microsoft\Windows\WER\ReportArchive\*\*"/>
    <action command="delete" search="walk.files" path="%ProgramData%\Microsoft\Windows\WER\ReportQueue\*\*"/>
    <action command="delete" search="file" path="%WinDir%\pchealth\helpctr\Logs\hcupdate.log"/>
  </option>
  <option id="shadow_copies">
    <label>Shadow copies</label>
    <description>Delete all shadow copies on C:</description>
    <warning>Use the option only if you know what you do!</warning>
    <action command="process" cmd="vssadmin.exe delete shadows /for=c: /all"/>
  </option>
  <option id="recycle_bin">
    <label>Recycle bin</label>
    <description>Delete the recycle bin on drive C: from all user accounts</description>
    <warning>Use the option only if you know what you do!</warning>
    <!-- This is how it was documented, but don't work, because "rd" is no standalone app! -->
    <!-- <action command="process" cmd="cmd.exe /c rd /s c:\$Recycle.Bin"/> -->
    <!-- Windows 7 and above: -->
    <action command="delete" search="walk.all" path="%SystemDrive%\$Recycle.Bin"/>
    <action command="delete" search="file" path="%SystemDrive%\$Recycle.Bin"/>
    <!-- Windows Vista and earlier: -->
    <action command="delete" search="walk.all" path="%SystemDrive%\RECYCLER"/>
    <action command="delete" search="file" path="%SystemDrive%\RECYCLER"/>
  </option>
  <option id="cache">
    <label>Cache</label>
    <description>Delete the cache</description>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Feeds Cache\"/>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Terminal Server Client\Cache\"/>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\AppCache\"/>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\Caches\"/>
    <action command="delete" search="walk.all" path="%LocalAppData%\Microsoft\Windows\SchCache\"/>
    <action command="delete" search="walk.all" path="%LocalAppDataLow%\Microsoft\CryptnetUrlCache\"/>
    <!-- Empty folder on the demo machine: (Tobias) -->
    <action command="delete" search="walk.all" path="%LocalAppDataLow%\Microsoft\Windows\AppCache\"/>
  </option>
  <option id="prefetch">
    <label>Prefetch</label>
    <description>Delete the cache</description>
    <action command="delete" search="walk.files" path="%WinDir%\Prefetch\*"/>
  </option>
  <option id="search_index">
    <label>Windows Search Index</label>
    <description>Delete the files</description>
    <warning>It may be nessesary that you deactivate the Windows Search Service first, manually!</warning>
    <action command="process" wait="true" cmd="sc config WSearch start= disabled"/>
    <action command="delete" search="file" path="%ProgramData%\Microsoft\Search\Data\Applications\Windows\Windows.edb"/>
    <action command="delete" search="file" path="%ProgramData%\Microsoft\Search\Data\Applications\Windows\tmp.edb"/>
    <action command="delete" search="walk.all" path="%ProgramData%\Microsoft\Search\Data\Applications\Windows\GatherLogs\SystemIndex\"/>
    <action command="delete" search="walk.all" path="%ProgramData%\Microsoft\Search\Data\Applications\Windows\Projects\SystemIndex\Indexer\CiFiles\"/>
    <action command="process" cmd="sc config WSearch start= auto"/>
  </option>
  <option id="muicache">
    <label>MUICache</label>
    <description>Delete the cache</description>
    <action command="winreg" path="HKCU\Software\Microsoft\Windows\ShellNoRoam\MUICache"/>
    <action command="winreg" path="HKCU\Software\Classes\Local Settings\Software\Microsoft\Windows\Shell\MuiCache"/>
  </option>
</cleaner>
